<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
    <link rel="stylesheet" type="text/css" href="static/stylesheet.css" media="screen"/>

  </head>
  <body>
    <h1>where's my Plague at?</h1>

    <% retrieve_geoJson %>

<!-- *** amCharts Pie Chart *** -->
<script src="//www.amcharts.com/lib/4/core.js"></script>
<script src="//www.amcharts.com/lib/4/charts.js"></script>
<script src="//www.amcharts.com/lib/4/themes/animated.js"></script>
<script src="//www.amcharts.com/lib/4/themes/amchartsdark.js"></script>

    <div id="introchart">
    </div>

    <script>

    // pieChart.data = [{
    //   "city": "Toronto",
    //   "cases":
    //   "fontColor": am4core.color("#222a3f"),
    //   "tickDisabled":true
    // }, {
    //   "city": "Mississauga",
    //   "cases":
    // }, {
    //   "city": "Newmarket",
    //   "cases":
    // }, {
    //   "city": "Hamilton",
    //   "cases": <%= hamilton %>
    // }, {
    //   "city": "Ottawa",
    //   "cases": <%= ottawa %>
    // }, {
    //   "city": "Windsor",
    //   "cases": <%= windsor %>
    // }];


    am4core.useTheme(am4themes_amchartsdark);
    am4core.useTheme(am4themes_animated);

    // main container
    var mainContainer = am4core.create("introchart", am4core.Container);
    mainContainer.width = am4core.percent(100);
    mainContainer.height = am4core.percent(100);

    var pieChart = mainContainer.createChild(am4charts.PieChart);
    pieChart.radius = am4core.percent(70);
    pieChart.innerRadius = am4core.percent(40);

    pieChart.data = [{
        "name": "Mississauga"
        // "fontColor": am4core.color("#222a3f"),
        "value": <%= mississauga %>,
        "radius": 20,
        "tickDisabled":false
    }, {
        "name": "Toronto",
        "value": <%= toronto %>,
        "tickDisabled":true
    }, {
        "name": "Newmarket",
        "value": <%= newmarket %>,
        "tickDisabled":true
    }, {
        "name": "Hamilton",
        "value": <%= hamilton %>,
        "tickDisabled":true
    }, {
        "name": "Ottawa",
        "value": <%= ottawa %>,
        "tickDisabled":true
    }, {
        "name": "Windsor",
        "value": <%= windsor %>,
        "tickDisabled":true
    }];

    var pieSeries = pieChart.series.push(new am4charts.PieSeries());
    pieSeries.dataFields.value = "value";
    pieSeries.dataFields.category = "name";
    pieSeries.alignLabels = false;

    pieSeries.ticks.template.propertyFields.disabled = "tickDisabled";

    pieSeries.labels.template.text = "{category}";
    pieSeries.labels.template.propertyFields.fill = "fontColor";
    pieSeries.labels.template.propertyFields.disabled = "labelDisabled";
    pieSeries.labels.template.radius = am4core.percent(-30);
    pieSeries.labels.template.propertyFields.radius = "radius";

    pieSeries.slices.template.tooltipText = "{category}";
    pieSeries.slices.template.cornerRadius = 8;
    // this single line creates initial animation
    pieSeries.hiddenState.properties.endAngle = -90;


    pieSeries.events.on("ready", function(){
      setTimeout(hideSlices, 3000);
    })

    // hide all slices except one
    function hideSlices(){
        pieSeries.slices.each(function(slice){
            if(slice.dataItem.index != 1){
                slice.dataItem.hide();
            }
        })

        setTimeout(showSlices, 2000);
    }

    function showSlices(){
        pieSeries.slices.each(function(slice){
            slice.dataItem.show();
        })

        setTimeout(hideSlices, 2000);
    }

</script>

     <!-- *** google heat map *** -->

        <div id="map">
          <%= google_api_call %>
        </div>

        <script>
          alert("be present");

          var heatmapData = [
            new google.maps.LatLng(43.6532, -79.3794),
            new google.maps.LatLng(43.6532, -79.3783),
            new google.maps.LatLng(43.6532, -79.3710)
          ];

          var covidToronto = new google.maps.LatLng(43.6532, -79.3832);

          map = new google.maps.Map(document.getElementById('map'), {
            center: covidToronto,
            zoom: 13,
            mapTypeId: 'satellite'
          });

          var heatmap = new google.maps.visualization.HeatmapLayer({
            data: heatmapData
          });
          heatmap.setMap(map);
        </script>



  </body>
</html>
